\section{Closed-loop model checking of device software}
Short of clinical trials (which we cover later in this article), current validation practice for closed-loop medical devices focuses on open-loop testing and reviews of the design process.
In such open-loop testing, a set of input sequences is fed to the device, and the device's output is checked for correctness, typically by comparing it to a pre-defined expected output.
Such testing does not evaluate the effect of the device on the organ: e.g., we can't test how the heart rate changes following a pacing by the pacemaker.
Thus, we need a heart model that can interact with the device. 
If we use, say, a high-fidelity PDE-based model such as the electro-mechanical models described earlier to react to the device and generate input sequences, there are an infinite number of heart rhythms that such a model can generate, and testing only uses a finite subset of those.
Thus, testing (whether open-loop or closed-loop with a heart model) is necessarily an incomplete technique, and safety violations of the device may be missed during testing.

The timed automata-based EP models are amenable to \emph{model checking}, a technique that mathematically explores \emph{all} possible executions of the heart model and device software combination against specified requirements (e.g. the pacemaker will not pace the heart beyond an upper rate limit). 
Model checking is widely used in the semiconductor industry to verify chip designs at various levels of abstraction, in particular at the Register Transfer Level (RTL).
Violations of the requirements are returned by the model checking tool as an execution trace, which can be analyzed and used to improve the system. 
To capture the variability in the heart's behavior (more generally, in the physiological phenomena of interest), the heart model is \emph{non-deterministic}: for example, rather than specifying that the conduction delay in the AV node is always 0.14ms, we allow it to be any value in the correct physiological range [0.12, 0.2] ms.
The model checker will \emph{symbolically} explore all executions corresponding to all values in this range (rather than select a few) in search for requirements violations. Subtle errors in the design of safety-critical systems that often elude conventional simulation and testing techniques can be (and have been) found in this way. Because it has been proven cost-effective and integrates well with conventional design methods, model checking has been adopted as a standard procedure for the quality assurance of  automotive and avionics systems, but has yet to enter the world of medical devices.

Endless Loop Tachycardia (ELT) is one example of a safety hazard that arises in the interaction between pacemaker and heart, shown in \figref{ambiguity}.
The ELT starts with an early ventricular contraction (PVC), which is a common scenario even in a healthy person. 
The electrical signal travels from the ventricle to the atrium (red arrows in \figref{ambiguity}), triggering an atrial sense (AS), i.e. the pacemaker senses an event in the right atrium. 
As a result, the pacemaker paces the ventricle (VP) after a pre-programed delay (AVI), which triggers ventricle to atrium conduction again and this VP $\rightarrow$ AS $\rightarrow$ VP positive feedback loop persists. 
The ventricular rate during ELT is determined by the conduction delay from the ventricle to the atrium and the programed delay in the pacemaker, which is very fast.
The healthy condition in \figref{ambiguity} demonstrates the same input-output sequence as ELT. 
In it, the pacemaker paces the ventricle after each atrial event (AS) generated by the SA node (as opposed to an AS conducted from the ventricle as in ELT).
This is correct pacing at an appropriate (and relatively much slower) rate than ELT, and consequently maintains adequate blood flow. 
Failing to distinguish these two conditions in the heart model may introduce false-positive when checking whether ELT exists, i.e. the healthy case returned as evidence for ELT.
%The heart model should be able to distinguish these two conditions to assess the pacemaker's ELT elimination capabilities so that they do not affect other healthy heart functions, which would be otherwise a false-positive.

\begin{figure}[t]
	\centering
	\includegraphics[width=\textwidth]{figs/ambiguity.pdf}
	\caption{\small Endless-loop Tachycardia (ELT) and a healthy heart condition mapped to the same input-output execution of the pacemaker (middle sequence). The heart model should have the details to resolve this ambiguity.}
	\label{fig:ambiguity}
\end{figure}
% \yhl{The heart model should be able to distinguish these two conditions so that an ELT elimination algorithm}
\input{abstractiontree}


